"use strict";function generate_global_constants(a,b){erg._global_constants||(erg._global_constants=[]),erg._global_constants[a]=erg._global_constants[a]||{};var c=0;for(var d in b)erg._global_constants[a][b[d]]=__global[b[d]]=c++,erg._global_constants[a][d]=b[d]}function get_global_constant_name(a,b){return erg._global_constants[a][b]}function expect(a,b){if(a.type!==b)throw new Error("token.type was not "+b+" for "+JSON.stringify(a));return!0}function accept(a,b){return null==a?!1:a.type===b?!0:!1}function find_function_in_scope(a,b){if("print"==b)return{identifier:"print",isBuiltIn:!0,parameters:[{name:"message",dataType:"any"}]};for(;null!==a;){if(a.statements&&a.statements.length>0)for(var c=0;c<a.statements.length;c++)if(a.statements[c].type===AST_NODE_TYPE_FUNCTION_DECLARATION&&a.statements[c].identifier===b)return a.statements[c];a=a.parent}return null}function find_variable_in_scope(a,b){for(;null!==a;){if(a.statements&&a.statements.length>0)for(var c=0;c<a.statements.length;c++)if(a.statements[c].type===AST_NODE_TYPE_VARIABLE_DECLARATION&&a.statements[c].text===b)return a.statements[c];a=a.parent}return null}function create_token_parser(a){var b=0;return{peek:function(){var c=a[b];return null===c||void 0===c?null:c},eat:function(){b++}}}function create_ast(a){return parse_top_scope(a)}function parse_top_scope(a){var b=create_token_parser(a),c=ast_create_scope(null);c.type=AST_NODE_TYPE_PROGRAM;var d=c;return c.parameters.push(ast_create_parameter({name:"global",dataType:"any",isInitialized:!0})),parse_scope(d,b),c}function parse_scope(a,b){for(;null!==b.peek();)if(accept(b.peek(),TOKEN_TYPE_BRACE_OPEN))b.eat(),parse_scope(ast_create_scope(a),b);else{if(accept(b.peek(),TOKEN_TYPE_BRACE_CLOSE))return void b.eat();parse_statement(a,b)}}function parse_function_scope(a,b){for(;null!==b.peek()&&b.peek().type!==TOKEN_TYPE_BRACE_CLOSE;)accept(b.peek(),TOKEN_TYPE_BRACE_OPEN)?b.eat():parse_statement(a,b)}function parse_function_parameters(a,b,c){for(;null!==b.peek()&&b.peek().type!==TOKEN_TYPE_PAREN_CLOSE;)if(accept(b.peek(),TOKEN_TYPE_COMMA))b.eat();else{if(!accept(b.peek(),TOKEN_TYPE_IDENTIFIER))throw new Error("Unexpected Function Parameter: "+b.peek());var d=b.peek().text,e=null;b.eat(),accept(b.peek(),TOKEN_TYPE_SINGLE_COLON)&&(b.eat(),expect(b.peek(),TOKEN_TYPE_IDENTIFIER)&&("string"===b.peek().text?e="string":"int"===b.peek().text?e="int":"bool"===b.peek().text&&(e="bool"),b.eat())),c.parameters.push(ast_create_parameter({name:d,dataType:e||"any"}))}b.eat()}function parse_function_arguments(a,b,c,d){function e(a){for(var b=0,c=0;c<a.length;c++)a[c].type!==AST_NODE_TYPE_OPERATOR&&b++;return b}for(var f=d.parameters.length;null!==b.peek()&&b.peek().type!==TOKEN_TYPE_SEMICOLON;)parse_expression(a,b,c),b.eat();var g=e(c.rhs.parts);if(f!==g)throw new Error("Function call to "+d.identifier+" expects "+f+" arguments but was provided "+g);for(var h=0;h<d.parameters.length;h++)if("any"!==d.parameters[h].dataType&&c.rhs&&c.rhs.parts&&c.rhs.parts[h].dataType!==d.parameters[h].dataType)throw new Error("Function call "+d.identifier+" expects argument "+h+" to be of type "+d.parameters[h].dataType+" but was provided a literal of type "+c.expression.parts[h].dataType)}function parse_function_declaration(a,b,c){var d=ast_create_function_declaration({identifier:c,body:ast_create_scope(a,AST_NODE_TYPE_FUNCTION_SCOPE)});a.statements.push(d),parse_function_parameters(d.body,b,d),parse_function_scope(d.body,b)}function parse_function_execution(a,b,c){var d=ast_create_function_call({identifier:c,found:!1}),e=find_function_in_scope(a,c);if(null!==e&&e.isBuiltIn===!0)d.found=!0,d.builtin=!0;else{if(!e)throw new Error("Unknown function "+c);d.found=!0}parse_function_arguments(a,b,d,e),a.statements.push(d)}function parse_statement(a,b){accept(b.peek(),TOKEN_TYPE_IDENTIFIER)&&!function(){var c=b.peek(),d=c.text;b.eat(),accept(b.peek(),TOKEN_TYPE_COLON_EQUALS)&&(b.eat(),parse_variable_declaration(a,b,d)),accept(b.peek(),TOKEN_TYPE_PAREN_OPEN)&&(b.eat(),parse_function_execution(a,b,d)),accept(b.peek(),TOKEN_TYPE_DOUBLE_COLON)&&(b.eat(),accept(b.peek(),TOKEN_TYPE_PAREN_OPEN)&&(b.eat(),parse_function_declaration(a,b,d)))}(),b.eat()}function parse_expression(a,b,c){var d=!1,e=TOKEN_TYPE_SEMICOLON,f=!1;for((c.type===AST_NODE_TYPE_FUNCTION_CALL||c.type===AST_NODE_TYPE_FUNCTION_DECLARATION)&&(e=TOKEN_TYPE_PAREN_CLOSE,f=!0);null!==b.peek()&&b.peek().type!==e;)accept(b.peek(),TOKEN_TYPE_NULL)?(c.rhs=c.rhs||ast_create_expression(),c.rhs.parts.push(ast_create_literal("null","null")),d=!0,b.eat()):!accept(b.peek(),TOKEN_TYPE_IDENTIFIER)||"true"!==b.peek().text&&"false"!==b.peek().text?accept(b.peek(),TOKEN_TYPE_IDENTIFIER)?(c.rhs=c.rhs||ast_create_expression(),c.rhs.parts.push(ast_create_identifier(b.peek().text)),d=!0,b.eat()):accept(b.peek(),TOKEN_TYPE_PLUS)?(c.rhs=c.rhs||ast_create_expression(),c.rhs.parts.push(ast_create_operator(b.peek().text)),d=!0,b.eat()):accept(b.peek(),TOKEN_TYPE_STRING_LITERAL)?(c.rhs=c.rhs||ast_create_expression(),c.rhs.parts.push(ast_create_literal("string",b.peek().text)),d=!0,b.eat()):accept(b.peek(),TOKEN_TYPE_NUMBER_LITERAL)?(c.rhs=c.rhs||ast_create_expression(),c.rhs.parts.push(ast_create_literal("int",b.peek().text)),d=!0,b.eat()):accept(b.peek(),TOKEN_TYPE_IDENTIFIER)||(f&&accept(b.peek(),TOKEN_TYPE_COMMA)?(c.rhs=c.rhs||ast_create_expression(),c.rhs.parts.push(ast_create_operator(b.peek().text)),d=!0,b.eat()):b.eat()):(c.rhs=c.rhs||ast_create_expression(),c.rhs.parts.push(ast_create_literal("bool",b.peek().text)),c.dataType="bool",d=!0,b.eat());return d}function parse_variable_declaration(a,b,c){var d={identifier:c,dataType:"any",isInitialized:!1},e={type:AST_NODE_TYPE_VARIABLE_DECLARATION,lhs:d,rhs:null},f=(ast_create_variable_declaration(d),ast_create_statement(e));parse_expression(a,b,f),a.statements.push(f)}function ast_create_node(a,b){var c=b||{};return c.type=a||AST_NODE_TYPE_UNKNOWN,c.typeName=get_global_constant_name("AST_NODE_TYPES",a),c}function ast_create_scope(a,b){if(void 0===a)throw new Error("ast_create_scope was not given a parentScope");return ast_create_node(b||AST_NODE_TYPE_SCOPE,{parameters:[],statements:[],parent:a,scopeDepth:ast_count_scope_depth(a)+1})}function ast_create_statement(a){var b={lhs:null,rhs:null},c=$.extend({},b,a);return ast_create_node(AST_NODE_TYPE_STATEMENT,c)}function ast_create_variable_declaration(a){var b={identifier:null,type:AST_NODE_TYPE_VARIABLE_DECLARATION,dataType:null,isInitialized:!1},c=$.extend({},b,a);return ast_create_node(c.type,c)}function ast_create_variable_expression(){}function ast_create_boolean_expression(){}function ast_create_or_expression(){}function ast_create_and_expression(){}function ast_create_not_expression(){}function ast_create_expression(a){var b={parts:[]},c=$.extend({},b,a);return ast_create_node(AST_NODE_TYPE_EXPRESSION,c)}function ast_create_parameter(a){var b={name:null,dataType:"any",isInitialized:!1},c=$.extend({},b,a);return ast_create_node(AST_NODE_TYPE_PARAMETER,c)}function ast_create_literal(a,b){var c={dataType:a||"any",isInitialized:void 0!==b,value:b};return ast_create_node(AST_NODE_TYPE_LITERAL,c)}function ast_create_operator(a){return ast_create_node(AST_NODE_TYPE_OPERATOR,{operator:a})}function ast_create_function_declaration(a){var b={identifier:"",parameters:[],body:null,isBuiltIn:!1},c=$.extend({},b,a);return ast_create_node(AST_NODE_TYPE_FUNCTION_DECLARATION,c)}function ast_create_function_call(a){var b={identifier:"",builtin:!1,found:!1,expression:null},c=$.extend({},b,a);return ast_create_node(AST_NODE_TYPE_FUNCTION_CALL,c)}function ast_create_identifier(a){return ast_create_node(AST_NODE_TYPE_IDENTIFIER,{identifier:a})}function ast_count_scope_depth(a){for(var b=0,c=a;c&&null!==c.parent;)c=c.parent,b++;return b}var __global=this,erg;!function(){erg=__global.erg||{},__global.erg=erg,"object"==typeof module&&"object"==typeof module.exports&&(module.exports=erg)}(this),erg.createScanner=function(a){var b=0,c=1,d=1,e=c;return{peek:function(){return b<a.length?a[b]:null},eat:function(){"\n"===a[b]&&(d++,e=c-1),b++,e++},get_position_info:function(){return{lineNo:d,colNo:e}}}},generate_global_constants("TOKEN_TYPES",["TOKEN_TYPE_UNKNOWN","TOKEN_TYPE_NULL","TOKEN_TYPE_WHITESPACE","TOKEN_TYPE_COMMENT_SINGLE_LINE","TOKEN_TYPE_IDENTIFIER","TOKEN_TYPE_STRING_LITERAL","TOKEN_TYPE_NUMBER_LITERAL","TOKEN_TYPE_BOOLEAN_LITERAL","TOKEN_TYPE_PAREN_OPEN","TOKEN_TYPE_PAREN_CLOSE","TOKEN_TYPE_BRACE_OPEN","TOKEN_TYPE_BRACE_CLOSE","TOKEN_TYPE_SEMICOLON","TOKEN_TYPE_SINGLE_COLON","TOKEN_TYPE_DOUBLE_COLON","TOKEN_TYPE_COLON_EQUALS","TOKEN_TYPE_COMMA","TOKEN_TYPE_KEYWORD_RETURN","TOKEN_TYPE_PLUS"]),erg.createTokenizer=function(a){function b(){return a.peek()}function c(){a.eat()}function d(b){var c=a.get_position_info();b.lineNo=c.lineNo,b.colNo=c.colNo}function e(b,c){var d=a.get_position_info();return{type:b,typeName:get_global_constant_name("TOKEN_TYPES",b),text:c,lineNo:d.lineNo,colNo:d.colNo}}function f(){for(var a="";null!==(m=b())&&/[a-zA-Z0-9_]/gi.test(m)!==!1;)a+=m,c();return a}function g(){c();for(var a="";null!==(m=b());){if('"'===m){c();break}a+=m,c()}return a}function h(){for(var a="";null!==(m=b())&&m>="0"&&"9">=m;)a+=m,c();return a}function i(a){var b=n[a];return void 0===b?null:(o=e(b,a),d(o),c(),o)}function j(a){for(;k()&&m!==a;);}function k(){return c(),m=b(),null===m?!1:!0}function l(){do if("/"===m&&k()&&"*"===m)p++;else if("*"===m&&k()&&"/"===m)p--;else if(-1===p){p=0;break}while(k())}var m,n={" ":TOKEN_TYPE_WHITESPACE,"	":TOKEN_TYPE_WHITESPACE,"\n":TOKEN_TYPE_WHITESPACE,"(":TOKEN_TYPE_PAREN_OPEN,")":TOKEN_TYPE_PAREN_CLOSE,"{":TOKEN_TYPE_BRACE_OPEN,"}":TOKEN_TYPE_BRACE_CLOSE,";":TOKEN_TYPE_SEMICOLON,",":TOKEN_TYPE_COMMA,"+":TOKEN_TYPE_PLUS},o=null,p=0;return{peek:function(){var d=1;if(null!==o)return o;for(o=e(TOKEN_TYPE_UNKNOWN,"");null!==(m=b());){var k=i(m);if(null!==k){if(" "===m||"	"===m||"\n"===m)continue;return k}if("/"===m){if(c(),"*"===b()){c(),m=b(),l();continue}if("/"===b()){j("\n");continue}}if('"'===m)return o=e(TOKEN_TYPE_STRING_LITERAL,""),o.text=g(),o;if(m>="0"&&"9">=m)return o=e(TOKEN_TYPE_NUMBER_LITERAL,""),o.text=h(),o;if(":"===m)return d=a.get_position_info().colNo,c(),":"===b()?(o=e(TOKEN_TYPE_DOUBLE_COLON,m),c()):"="===b()?(o=e(TOKEN_TYPE_COLON_EQUALS,m),c()):o=e(TOKEN_TYPE_SINGLE_COLON,m),o.colNo=d,o;if(/[a-zA-Z]/gi.test(m))return o=e(TOKEN_TYPE_IDENTIFIER,""),o.text=f(),o;var n=a.get_position_info();return console.error("ERROR: Unexpected character '"+m+"' (ln: "+n.lineNo+", col: "+n.colNo+")"),null}return null},eat:function(){o=null}}},generate_global_constants("AST_NODE_TYPES",["AST_NODE_TYPE_UNKNOWN","AST_NODE_TYPE_PARAMETER","AST_NODE_TYPE_LITERAL","AST_NODE_TYPE_OPERATOR","AST_NODE_TYPE_IDENTIFIER","AST_NODE_TYPE_EXPRESSION","AST_NODE_TYPE_FUNCTION_DECLARATION","AST_NODE_TYPE_FUNCTION_CALL","AST_NODE_TYPE_PROGRAM","AST_NODE_TYPE_SCOPE","AST_NODE_TYPE_FUNCTION_SCOPE","AST_NODE_TYPE_STATEMENT","AST_NODE_TYPE_VARIABLE_DECLARATION"]),erg.compile=function(a,b){b&&(console.log(a),console.log(a.length));for(var c,d="",e=erg.createScanner(a),f=erg.createTokenizer(e,!0),g=[];null!==(c=f.peek());)b&&console.log("TOKEN: (ln: "+c.lineNo+", col: "+c.colNo+") - "+c.typeName+" - Text: "+c.text),g.push(c),f.eat();b&&(console.log(g),console.log(d),console.log(a.length));var h=create_ast(g);return b&&console.log(h),generate_js(h)};